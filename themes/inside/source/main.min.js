// var script = document.createElement("script");
// script.type = "text/javascript";
// script.id = 'clustrmaps';
// script.src =  '//clustrmaps.com/map_v2.js?d=NN6CrFgiT6g5STfQdgu1v91lB8TY5dqmU7iLIxocfY0&cl=ffffff&w=a';
// document.body.appendChild(script);
// 12-22
// // å®ä¾‹åŒ– VConsole å¯¹è±¡
// var vConsole = new VConsole();
// // å¯ç”¨ VConsole
// vConsole.show();

addMobileLive2dCss();
Jinx();
ipMap();

// appç¯å¢ƒä¸æ·»åŠ ç½‘æ˜“äº‘å¤–é“¾
// appç¯å¢ƒç½‘æ˜“äº‘å¤–é“¾ä¸æ”¯æŒï¼Œè‡ªåŠ¨åŠ è½½httpçš„ä¸œè¥¿ï¼Œå’Œåšå®¢ç½‘ç«™httpså†²çª
if (isMobile()) {
  addMobileLive2dCss();
} else {
  musicBox();
  removeMusicBox();
}

// å†™è¿™é‡Œåº”è¯¥æ²¡äººå‘ç°å§ğŸ˜ƒğŸ˜ƒğŸ˜ƒ
function Jinx() {
  console.log(
    "%c Jinxå¤©å¤©å¼€å¿ƒå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ %c https://jinx66.gitee.io/",
    "color:#fff;font-size: 14px;font-family: serif;background:linear-gradient(90deg,#ff4d91,#ff4d91);padding:15px 10px;",
    "color:#000;background:linear-gradient(90deg,#ff4d91,#ffffff);padding:15px 10px;font-size: 14px;font-family: serif;"
  );
}

function ipMap() {
  //æ·»åŠ iframeæ ‡ç­¾
  var body = document.getElementsByTagName("body");
  var div = document.createElement("div");
  div.innerHTML =
    '<a href="https://clustrmaps.com/site/1bv4l" title="Visit tracker"><img src="//www.clustrmaps.com/map_v2.png?d=NN6CrFgiT6g5STfQdgu1v91lB8TY5dqmU7iLIxocfY0&cl=ffffff"></a>';
  div.id = "ip-map";
  document.body.appendChild(div);
}
function addMobileLive2dCss() {
  console.log(123);
  if (isMobile()) {
    console.log(123);
    const link = document.createElement("link");
    link.rel = "stylesheet";
    link.href = "/mobileLive2d.css"; // æ›¿æ¢ä¸ºæ‚¨CSSæ–‡ä»¶çš„è·¯å¾„
    document.head.appendChild(link);
  }
}
function musicBox() {
  //æ·»åŠ iframeæ ‡ç­¾
  var body = document.getElementsByTagName("body");
  var div = document.createElement("div");
  div.innerHTML =
    '<div id="drag" class="move"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=300 src="https://music.163.com/outchain/player?type=0&id=2327585234&auto=1&height=430"></iframe><div class="mask"></div><div class="close"></div></div>';
  document.body.appendChild(div);
  // æ‹–æ‹½åŠŸèƒ½(ä¸»è¦æ˜¯è§¦å‘ä¸‰ä¸ªäº‹ä»¶ï¼šonmousedown\onmousemove\onmouseup)
  var drag = document.getElementById("drag");
  var divMask = document.querySelector(".mask");

  // ç‚¹å‡»æŸç‰©ä½“æ—¶ï¼Œç”¨dragå¯¹è±¡å³å¯ï¼Œmoveå’Œupæ˜¯å…¨å±€åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªæ–‡æ¡£é€šç”¨ï¼Œåº”è¯¥ä½¿ç”¨documentå¯¹è±¡è€Œä¸æ˜¯dragå¯¹è±¡(å¦åˆ™ï¼Œé‡‡ç”¨dragå¯¹è±¡æ—¶ç‰©ä½“åªèƒ½å¾€å³æ–¹æˆ–ä¸‹æ–¹ç§»åŠ¨)
  drag.onmousedown = function (e) {
    var e = e || window.event; // å…¼å®¹ieæµè§ˆå™¨
    var diffX = e.clientX - drag.offsetLeft; // é¼ æ ‡ç‚¹å‡»ç‰©ä½“é‚£ä¸€åˆ»ç›¸å¯¹äºç‰©ä½“å·¦ä¾§è¾¹æ¡†çš„è·ç¦»=ç‚¹å‡»æ—¶çš„ä½ç½®ç›¸å¯¹äºæµè§ˆå™¨æœ€å·¦è¾¹çš„è·ç¦»-ç‰©ä½“å·¦è¾¹æ¡†ç›¸å¯¹äºæµè§ˆå™¨æœ€å·¦è¾¹çš„è·ç¦»
    var diffY = e.clientY - drag.offsetTop;

    /* ä½ç‰ˆæœ¬ie bug:ç‰©ä½“è¢«æ‹–å‡ºæµè§ˆå™¨å¯æ˜¯çª—å£å¤–éƒ¨æ—¶ï¼Œè¿˜ä¼šå‡ºç°æ»šåŠ¨æ¡ï¼Œ
                      è§£å†³æ–¹æ³•æ˜¯é‡‡ç”¨ieæµè§ˆå™¨ç‹¬æœ‰çš„2ä¸ªæ–¹æ³•setCapture()\releaseCapture(),è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œ
                      å¯ä»¥è®©é¼ æ ‡æ»‘åŠ¨åˆ°æµè§ˆå™¨å¤–éƒ¨ä¹Ÿå¯ä»¥æ•è·åˆ°äº‹ä»¶ï¼Œè€Œæˆ‘ä»¬çš„bugå°±æ˜¯å½“é¼ æ ‡ç§»å‡ºæµè§ˆå™¨çš„æ—¶å€™ï¼Œ
                      é™åˆ¶è¶…è¿‡çš„åŠŸèƒ½å°±å¤±æ•ˆäº†ã€‚ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå³å¯è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ³¨ï¼šè¿™ä¸¤ä¸ªæ–¹æ³•ç”¨äºonmousedownå’Œonmouseupä¸­ */
    if (typeof drag.setCapture !== "undefined") {
      drag.setCapture();
    }

    divMask.style.width = "100%";
    divMask.style.height = "100%";
    document.onmousemove = function (e) {
      var e = e || window.event; // å…¼å®¹ieæµè§ˆå™¨
      var left = e.clientX - diffX;
      var top = e.clientY - diffY;

      // æ§åˆ¶æ‹–æ‹½ç‰©ä½“çš„èŒƒå›´åªèƒ½åœ¨æµè§ˆå™¨è§†çª—å†…ï¼Œä¸å…è®¸å‡ºç°æ»šåŠ¨æ¡
      if (left < 0) {
        left = 0;
      } else if (left > window.innerWidth - drag.offsetWidth) {
        left = window.innerWidth - drag.offsetWidth;
      }
      if (top < 0) {
        top = 0;
      } else if (top > window.innerHeight - drag.offsetHeight) {
        top = window.innerHeight - drag.offsetHeight;
      }

      // ç§»åŠ¨æ—¶é‡æ–°å¾—åˆ°ç‰©ä½“çš„è·ç¦»ï¼Œè§£å†³æ‹–åŠ¨æ—¶å‡ºç°æ™ƒåŠ¨çš„ç°è±¡
      drag.style.left = left + "px";
      drag.style.top = top + "px";
    };
    document.onmouseup = function (e) {
      // å½“é¼ æ ‡å¼¹èµ·æ¥çš„æ—¶å€™ä¸å†ç§»åŠ¨
      console.log("this", this);
      this.onmousemove = null;
      this.onmouseup = null; // é¢„é˜²é¼ æ ‡å¼¹èµ·æ¥åè¿˜ä¼šå¾ªç¯ï¼ˆå³é¢„é˜²é¼ æ ‡æ”¾ä¸Šå»çš„æ—¶å€™è¿˜ä¼šç§»åŠ¨ï¼‰

      // ä¿®å¤ä½ç‰ˆæœ¬ie bug
      if (typeof drag.releaseCapture !== "undefined") {
        drag.releaseCapture();
      }

      divMask.style.width = "0";
      divMask.style.height = "0";
    };
  };
  const draggableElement = document.getElementById("drag");

  // å­˜å‚¨ä¸Šä¸€ä¸ªè§¦æ‘¸ä½ç½®çš„åæ ‡
  let lastTouchX = 0;
  let lastTouchY = 0;

  draggableElement.addEventListener("touchstart", function (event) {
    // è®°å½•è§¦æ‘¸å¼€å§‹æ—¶çš„ä½ç½®
    const touch = event.touches[0];
    lastTouchX = touch.clientX;
    lastTouchY = touch.clientY;
  });

  draggableElement.addEventListener("touchmove", function (event) {
    // é˜»æ­¢é»˜è®¤çš„æ»šåŠ¨è¡Œä¸º
    event.preventDefault();

    // è·å–å½“å‰è§¦æ‘¸çš„ä½ç½®
    const touch = event.touches[0];
    const currentTouchX = touch.clientX;
    const currentTouchY = touch.clientY;

    // è®¡ç®—ç§»åŠ¨è·ç¦»
    const deltaX = currentTouchX - lastTouchX;
    const deltaY = currentTouchY - lastTouchY;

    // è·å–å…ƒç´ å½“å‰çš„ä½ç½®
    let elementX = parseFloat(draggableElement.style.left) || 0;
    let elementY = parseFloat(draggableElement.style.top) || 0;

    // æ›´æ–°å…ƒç´ çš„ä½ç½®
    draggableElement.style.left = elementX + deltaX + "px";
    draggableElement.style.top = elementY + deltaY + "px";

    // æ›´æ–°ä¸Šä¸€ä¸ªè§¦æ‘¸ä½ç½®çš„åæ ‡
    lastTouchX = currentTouchX;
    lastTouchY = currentTouchY;
  });

  draggableElement.addEventListener("touchend", function (event) {
    // è§¦æ‘¸ç»“æŸæ—¶çš„å¤„ç†ï¼ˆå¯é€‰ï¼‰
  });
}

function removeMusicBox() {
  var myBtn = document.querySelector(".close");
  myBtn.addEventListener("click", function () {
    var musicBox = document.querySelector(".move");
    musicBox.style.display = "none";
    musicBox.remove();
  });
}
function isMobile() {
  let flag = navigator.userAgent.match(
    /(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i
  );
  return flag;
}

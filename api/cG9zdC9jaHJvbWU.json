{"title":"Chrome Devtools 日常使用","date":"2024-12-22T11:57:32.000Z","date_formatted":{"ll":"2024年12月22日","L":"2024/12/22","MM-DD":"12-22"},"thumbnail":"post/chrome/thumbnail.jpg","color":"#2f76d7","link":"post/chrome","comments":true,"tags":["Chrome"],"categories":["教程"],"updated":"2024-12-22T11:58:19.492Z","content":"<h2 id=\"chrome-devtools-的用处\">Chrome Devtools 的用处<a title=\"#chrome-devtools-的用处\" href=\"#chrome-devtools-的用处\"></a></h2>\n<ul>\n<li>前端开发：开发预览、远程调试、性能调优、<code>bug</code>跟踪、断点调试等</li>\n<li>前端开发：开发预览、远程调试、性能调优、bug跟踪、断点调试等</li>\n<li>后端开发：网络抓包、开发调试Response</li>\n<li>测试：服务端<code>API</code>数据是否正确、审查页面元素样式及布局、页面加载性能分析、自动化测试</li>\n<li>其他：安装扩展插件，如<code>AdBlock、Gliffy、Axure</code>等</li>\n</ul>\n<h2 id=\"菜单面板拆解\">菜单面板拆解<a title=\"#菜单面板拆解\" href=\"#菜单面板拆解\"></a></h2>\n<ul>\n<li><code>Elements</code> - 页面dom元素</li>\n<li><code>Console</code> - 控制台</li>\n<li><code>Sources</code> - 页面静态资源</li>\n<li><code>Network</code> - 网络</li>\n<li><code>Performance</code> - 设备加载性能分析</li>\n<li><code>Application</code> - 应用信息，PWA/Storage/Cache/Frames</li>\n<li><code>Security</code> - 安全分析</li>\n<li><code>Audits</code> - 审计，自动化测试工具</li>\n</ul>\n<p>我的移动端网页<a href=\"https://jinx66.gitee.io/\" target=\"_blank\">jinx66</a></p>\n<p><img src=\"post/chrome/ebded4d78c50b3b3244d0c9c4586891.png\" alt=\"图片变灰色点一下也能看..\" loading=\"lazy\" class=\"φbp\"></p>\n<h2 id=\"使用技巧\">使用技巧<a title=\"#使用技巧\" href=\"#使用技巧\"></a></h2>\n<ul>\n<li>打印对象的小技巧</li>\n</ul>\n<p>之前的打印是</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;hello&#x27;</span>, hello);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;world&#x27;</span>, world);</span><br></pre></td></tr></table></figure>\n<p>高级点的打印是</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(&#123;hello, world&#125;);</span><br></pre></td></tr></table></figure>\n<p>这样就看到key和value了</p>\n<ul>\n<li><code>getEventListeners（object）</code>：获取指定对象的绑定事件</li>\n</ul>\n<p><code>getEventListeners(object)</code>返回在指定对象上注册的事件侦听器。返回值是一个对象，其中包含每个已注册事件类型（例如，<code>click</code>或<code>keydown</code>）的数组。每个数组的成员是描述为每种类型注册的侦听器的对象。</p>\n<ul>\n<li>变量打印：<code>%s、%o、%d、</code>和<code>%c</code></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> text = <span class=\"string\">&quot;文本1&quot;</span></span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">`打印<span class=\"subst\">$&#123;text&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>\n<p>还有比较特殊的<code>%c</code>，可用于改写输出样式。<br>\n这是我网站console.log打印的，f12可以看</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(</span><br><span class=\"line\">  <span class=\"string\">&quot;%c Jinx天天开心哈哈哈哈哈哈 %c https://jinx66.gitee.io/&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;color:#fff;font-size: 14px;font-family: serif;background:linear-gradient(90deg,#ff4d91,#ff4d91);padding:15px 10px;&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;color:#000;background:linear-gradient(90deg,#ff4d91,#ffffff);padding:15px 10px;font-size: 14px;font-family: serif;&quot;</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<p>你还可以这么玩：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;%c Auth &#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;color: white; background-color: #2274A5&#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;Login page rendered&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;%c GraphQL &#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;color: white; background-color: #95B46A&#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;Get user details&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;%c Error &#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;color: white; background-color: #D33F49&#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;Error getting user details&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;%c 想 &#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;color: white; background-color: #ff4d91&#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;miss&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;%c 你 &#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;color: white; background-color: #ff4d91&#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;you&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;%c 了 &#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;color: white; background-color: #ff9dc2&#x27;</span>, </span><br><span class=\"line\">            <span class=\"string\">&#x27;！！！！&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p><img src=\"post/chrome/424080ffebe1dac8d0bbef558077605.png\" alt=\"图片变灰色点一下也能看..\" loading=\"lazy\" class=\"φbp\"></p>\n<p>后面的有空的话会更新…</p>\n<p><code> 2024年1月29日更</code></p>\n<p><code> ===============================================================================================</code></p>\n<p>一年没更…最近项目中用到了console.log才想起这篇文章，小更一下</p>\n<h2 id=\"起因\">起因<a title=\"#起因\" href=\"#起因\"></a></h2>\n<p>因为我们前端一般是打包前端项目给后端，让后端帮忙发包，不是用jekins自动化部署，往往人为操作会导致打包命令打错或者是发包的时候没有找到正确目录，就会出现前后端互相甩锅的情况，前端说后端解压有问题，后端说前端打的包有问题，于是我就在每次打包的时候添加console.log信息以便于确认页面是否更新成功。在 Vue 2 项目中，你可以通过自定义 Webpack 的配置，在打包时将打包信息（如时间戳或 Git 提交哈希）嵌入到文件中。这种方式可以用来追踪版本变化。</p>\n<h2 id=\"配置文件\">配置文件<a title=\"#配置文件\" href=\"#配置文件\"></a></h2>\n<ul>\n<li>在 <code>vue.config.js</code> 中添加打包信息<br>\n如果你的项目使用 <code>Vue CLI</code>，可以在 <code>vue.config.js </code>中扩展 Webpack 配置：</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;webpack&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> dayjs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;dayjs&#x27;</span>); <span class=\"comment\">// 用于格式化日期</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> childProcess = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;child_process&#x27;</span>); <span class=\"comment\">// 获取Git信息</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">configureWebpack</span>: <span class=\"function\"><span class=\"params\">config</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取Git哈希值</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> gitHash = childProcess.<span class=\"title function_\">execSync</span>(<span class=\"string\">&#x27;git rev-parse --short HEAD&#x27;</span>).<span class=\"title function_\">toString</span>().<span class=\"title function_\">trim</span>();</span><br><span class=\"line\">    <span class=\"comment\">// 打包时间</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> buildTime = <span class=\"title function_\">dayjs</span>().<span class=\"title function_\">format</span>(<span class=\"string\">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> webpack.<span class=\"title class_\">DefinePlugin</span>(&#123;</span><br><span class=\"line\">          <span class=\"comment\">// 定义全局变量</span></span><br><span class=\"line\">          <span class=\"string\">&#x27;process.env&#x27;</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">VUE_APP_BUILD_TIME</span>: <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(buildTime),</span><br><span class=\"line\">            <span class=\"attr\">VUE_APP_GIT_HASH</span>: <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(gitHash),</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在代码中使用打包信息</li>\n</ul>\n<p>我是加在了<code>app.vue</code>文件上</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    // 这里省略掉app.vue的内容</span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"comment\">&lt;!-- &lt;p&gt;打包时间：&#123;&#123; buildTime &#125;&#125;&lt;/p&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-xml\">    &lt;p&gt;Git哈希值：&#123;&#123; gitHash &#125;&#125;&lt;/p&gt; --&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"title function_\">data</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"keyword\">return</span> &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"attr\">buildTime</span>: process.<span class=\"property\">env</span>.<span class=\"property\">VUE_APP_BUILD_TIME</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      <span class=\"attr\">gitHash</span>: process.<span class=\"property\">env</span>.<span class=\"property\">VUE_APP_GIT_HASH</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    &#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  <span class=\"title function_\">mounted</span>(<span class=\"params\"></span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">`%c <span class=\"subst\">$&#123;打包日期:&#125;</span> %c <span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.buildTime&#125;</span> `</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;padding: 2px 1px; border-radius: 3px 0 0 3px; color: #fff; background: #606060; font-weight: bold;&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">        <span class=\"string\">&#x27;padding: 2px 1px; border-radius: 0 3px 3px 0; color: #fff; background: #42c02e; font-weight: bold;&#x27;</span>,</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">      )</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">&#125;;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"打印结果\">打印结果<a title=\"#打印结果\" href=\"#打印结果\"></a></h2>\n<ul>\n<li>这是我项目中的打印结果，我去掉了哈希值的打印</li>\n</ul>\n<p><img src=\"post/chrome/ee4b413660d4c6f905737781fd12d0c.png\" alt=\"图片变灰色点一下也能看..\" loading=\"lazy\" class=\"φbp\"></p>\n<p>也可以加入版本号，至于什么时候需要添加版本号呢，当下面这种情况可以使用</p>\n<h2 id=\"在用户浏览页面时检测到页面已经有新的版本，并提示用户刷新获取最新页面\">在用户浏览页面时检测到页面已经有新的版本，并提示用户刷新获取最新页面<a title=\"#在用户浏览页面时检测到页面已经有新的版本，并提示用户刷新获取最新页面\" href=\"#在用户浏览页面时检测到页面已经有新的版本，并提示用户刷新获取最新页面\"></a></h2>\n<ul>\n<li>修改 vue.config.js</li>\n</ul>\n<p>在 <code>vue.config.js</code> 中，利用 Node.js 写入一个新的 <code>version.json</code> 文件，每次打包时动态更新文件内容。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> dayjs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;dayjs&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> gitHash = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;child_process&#x27;</span>).<span class=\"title function_\">execSync</span>(<span class=\"string\">&#x27;git rev-parse --short HEAD&#x27;</span>).<span class=\"title function_\">toString</span>().<span class=\"title function_\">trim</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> buildTime = <span class=\"title function_\">dayjs</span>().<span class=\"title function_\">format</span>(<span class=\"string\">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 生成 version.json 文件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> versionInfo = &#123;</span><br><span class=\"line\">  buildTime,</span><br><span class=\"line\">  gitHash,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">fs.<span class=\"title function_\">writeFileSync</span>(</span><br><span class=\"line\">  path.<span class=\"title function_\">resolve</span>(__dirname, <span class=\"string\">&#x27;public/version.json&#x27;</span>),</span><br><span class=\"line\">  <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(versionInfo, <span class=\"literal\">null</span>, <span class=\"number\">2</span>),</span><br><span class=\"line\">  <span class=\"string\">&#x27;utf-8&#x27;</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">module</span>.<span class=\"property\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"attr\">publicPath</span>: process.<span class=\"property\">env</span>.<span class=\"property\">VUE_APP_URL_PREPEND</span>,</span><br><span class=\"line\">  <span class=\"comment\">// 其他配置...</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>自动生成的 version.json 文件内容</li>\n</ul>\n<p>每次运行 <code>npm run build </code>时，会生成或更新<code> public/version.json</code> 文件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"> &#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;buildTime&quot;</span>: <span class=\"string\">&quot;2024-12-22 14:30:00&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;gitHash&quot;</span>: <span class=\"string\">&quot;a1b2c3d&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>前端检测逻辑<br>\n在前端代码中保持定时检查 version.json 文件的逻辑不变，具体代码如下：</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setInterval</span>(<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> <span class=\"title function_\">fetch</span>(<span class=\"string\">&#x27;/version.json&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> latestVersion = <span class=\"keyword\">await</span> response.<span class=\"title function_\">json</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> storedVersion = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(<span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">getItem</span>(<span class=\"string\">&#x27;appVersion&#x27;</span>) || <span class=\"string\">&#x27;&#123;&#125;&#x27;</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (latestVersion.<span class=\"property\">gitHash</span> !== storedVersion.<span class=\"property\">gitHash</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">$message</span>.<span class=\"title function_\">warning</span>(<span class=\"string\">&#x27;有新版本发布，请刷新页面！&#x27;</span>)</span><br><span class=\"line\">      <span class=\"variable language_\">localStorage</span>.<span class=\"title function_\">setItem</span>(<span class=\"string\">&#x27;appVersion&#x27;</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(latestVersion));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;版本检测失败:&#x27;</span>, error);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;, <span class=\"number\">60000</span>); <span class=\"comment\">// 每分钟检查一次</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"优势\">优势<a title=\"#优势\" href=\"#优势\"></a></h2>\n<ul>\n<li>全自动化：无需手动修改 version.json，版本信息在打包时自动生成。</li>\n<li>灵活扩展：可以根据需要在 version.json 中添加更多信息（如 versionName 或 branchName）。</li>\n<li>低维护成本：通过打包流程确保文件始终更新，无需人工干预。</li>\n</ul>\n<h2 id=\"适用场景\">适用场景<a title=\"#适用场景\" href=\"#适用场景\"></a></h2>\n<ul>\n<li>频繁发布：适合需要频繁更新的项目，自动化生成版本信息，减少人为操作。(我的公司就是频繁发布，🐕看了都摇头)</li>\n<li>前端独立部署：尤其适用于前端通过 CDN 或静态资源服务器直接部署的场景，能及时通知用户刷新页面获取最新内容。</li>\n</ul>\n<h2 id=\"工作原理\">工作原理<a title=\"#工作原理\" href=\"#工作原理\"></a></h2>\n<ul>\n<li>打包触发机制：vue.config.js 会在运行 npm run build 时自动被执行，这是 Vue CLI 的默认行为。</li>\n<li>文件生成逻辑：我们在 vue.config.js 中通过 Node.js 的 fs 模块动态创建或更新 public/version.json 文件。</li>\n<li>文件存放位置：生成的 version.json 会被放置在 public 目录下，因此会被 Vue CLI 的构建工具直接拷贝到打包后的 dist 文件夹中。</li>\n</ul>\n<h2 id=\"注意事项\">注意事项<a title=\"#注意事项\" href=\"#注意事项\"></a></h2>\n<ul>\n<li>路径：public/version.json 的路径必须是 public，因为 Vue CLI 会将 public 目录内容直接拷贝到 dist 中。</li>\n<li>权限：确保运行打包命令的用户有权限写入文件。</li>\n<li>刷新策略：前端轮询逻辑需要保持稳定，避免因请求失败导致提示异常。</li>\n</ul>\n<p><code> 2024年12月22日更</code></p>\n<p><code> ===============================================================================================</code></p>\n","next":{"title":"Lsy💗💗💗","link":"post/lovelsy"},"plink":"https://jinx66.gitee.io/post/chrome/","toc":[{"id":"chrome-devtools-的用处","title":"Chrome Devtools 的用处","index":"1"},{"id":"菜单面板拆解","title":"菜单面板拆解","index":"2"},{"id":"使用技巧","title":"使用技巧","index":"3"},{"id":"起因","title":"起因","index":"4"},{"id":"配置文件","title":"配置文件","index":"5"},{"id":"打印结果","title":"打印结果","index":"6"},{"id":"在用户浏览页面时检测到页面已经有新的版本，并提示用户刷新获取最新页面","title":"在用户浏览页面时检测到页面已经有新的版本，并提示用户刷新获取最新页面","index":"7"},{"id":"优势","title":"优势","index":"8"},{"id":"适用场景","title":"适用场景","index":"9"},{"id":"工作原理","title":"工作原理","index":"10"},{"id":"注意事项","title":"注意事项","index":"11"}],"reward":true,"copyright":{"author":"Jinx66","link":"<a href=\"https://jinx66.gitee.io/post/chrome/\" title=\"Chrome Devtools 日常使用\">https://jinx66.gitee.io/post/chrome/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International<br>(<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)","published":"2024年12月22日","updated":"2024年12月22日"},"reading_time":"1820 字约 12 分钟"}